<script src="/static/javascripts/jquery.js"></script>
<script src="/static/javascripts/jquery-ui.js"></script>
<script src="/static/javascripts/jquery.mousewheel.min.js"></script>
<script src="/static/javascripts/jarallax-0.2.4b.js"></script>

<link rel="import" href="/static/bower_components/polymer/polymer.html">
<link rel="import" href="/static/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/static/bower_components/paper-button/paper-button.html">

<dom-module id="project-history-jarallax">
  <style>
    :host {
      display: block;
    }
    #button{
      position:relative;
      display:block;
      text-indent:100px;
      width:20px;
      height:20px;
      border:5px solid #243651;
      border-radius:100px;
      overflow:hidden;
      background:white;
      margin-top:-18px;
      box-shadow:1px 1px 2px rgba(0,0,0,0.3);
    }

    #scrollbar{
      width:100%;
      background:#243651;
      height:5px;
      border-radius:10px;
      margin-top:20px;
    }

    #animation{
      height:600px;
      overflow:hidden;
      border:3px solid #f0f0f0;
      border-radius:20px;
    }
  </style>

  <template>
    </iron-ajax>
    <iron-ajax auto url="/api/project/git_test/log" handle-as="json" on-response="logResponse">
    </iron-ajax>

    <div id="animation">
    </div>
    <div id="scrollbar">
    </div>
    <div id="button" href="#">
      ScrollButton
    </div>
  </template>

  <script>
    Polymer({
      is: "project-history-jarallax",
      ready: function() {
        this.diffs = [];
        console.log('git-history-jarallax is ready');
      },
      logResponse: function(e) {
        // console.log(this);
        commits = e.detail.response.commits;
        console.log(commits);

        // commits.map( function(commit) {
        for(var i = 0; i< commits.length; i++) {
          var commit = commits[i];
          // console.log(commit);
          console.log(commit.sha);
          // commit.diff.diffs.map( function(diff) {
          for(var j = 0; j< commit.diff.diffs.length; j++) {
            var diff = commit.diff.diffs[j];
            // console.log(diff);
            if (diff.after_file == "b/chrome.json") {
              if (diff.before_file == "/dev/null") {
                for (var k = 0; k < diff.add.lines.length; k++) {
                  var div = document.createElement("div");
                  div.innerHTML = diff.add.lines[k]
                  this.$.animation.appendChild(div);// this is window not polymer
                }
              } else if (diff.before_file == "a/chrome.json") {
                console.log(diff);
              }
            }
          }
          // });
        }
        // });
        this.initJarallax();
      },
      initJarallax: function() {

        var keys = {38:-0.01, 40:0.01};

        var drag_controller = new ControllerDrag('#button',100,200);
        var key_controller = new ControllerKeyboard(keys, true, true);
        var wheel_controller = new ControllerMousewheel(0.01, true);

        jarallax = new Jarallax([drag_controller, key_controller, wheel_controller]);
      }
    });
  </script>

</dom-module>
